# ğŸ’° Kobbo - Gestion des DÃ©penses et Recettes Multi-SociÃ©tÃ©s

Kobbo est une application de gestion des finances personnelles et professionnelles permettant Ã 
un utilisateur de gÃ©rer ses dÃ©penses et recettes dans plusieurs sociÃ©tÃ©s Ã  partir dâ€™un seul compte.

---

## ğŸ“Œ FonctionnalitÃ©s principales

- Gestion multi-sociÃ©tÃ©s avec isolation logique des donnÃ©es
- Un utilisateur unique peut avoir plusieurs comptes dans diffÃ©rentes sociÃ©tÃ©s
- DÃ©finition de rÃ´les personnalisÃ©s par sociÃ©tÃ©
- Suivi des opÃ©rations (dÃ©penses / recettes)
- CatÃ©gorisation des opÃ©rations par nature
- Gestion des tiers (clients, fournisseurs, etc.)
- PiÃ¨ces justificatives (upload de fichiers via URL)

---

## ğŸ§± ModÃ¨le de donnÃ©es relationnel

L'application repose sur une base de donnÃ©es MySQL structurÃ©e comme suit :

### Tables et relations :

- **`societes`** : EntitÃ©s indÃ©pendantes reprÃ©sentant des entreprises.
- **`utilisateurs`** : Comptes d'accÃ¨s individuels, uniques et globaux.
- **`roles`** : DÃ©finis par chaque sociÃ©tÃ©, utilisÃ©s pour les autorisations.
- **`comptes_societe`** : Lien entre utilisateur, rÃ´le et sociÃ©tÃ©.
- **`tiers`** : Clients, fournisseurs, ou autres entitÃ©s externes associÃ©es Ã  des opÃ©rations.
- **`natures`** : CatÃ©gories d'opÃ©rations personnalisables par utilisateur-sociÃ©tÃ©.
- **`operations`** : ReprÃ©sentent les transactions financiÃ¨res (recettes ou dÃ©penses).

ğŸ“Š Un diagramme UML est fourni pour visualiser les relations entre les entitÃ©s :

![Diagramme - Kobbo](analyse.png)

---

## âš™ï¸ Technologies utilisÃ©es

- **Langage** : SQL / Java / Spring Boot
- **Base de donnÃ©es** : MySQL
- **SÃ©curitÃ©** : UUID, contraintes d'intÃ©gritÃ©, authentification (JWT)
- **Frontend** : Libre choix (Angular, React, etc.)

---

## ğŸ“ Processus de crÃ©ation de compte et dâ€™authentification

La crÃ©ation de compte sur la plateforme suit un processus bien dÃ©fini garantissant la cohÃ©rence des donnÃ©es en base et
une expÃ©rience utilisateur fluide.

### ğŸ§¾ CrÃ©ation de compte

L'utilisateur crÃ©e un compte personnel en remplissant un formulaire avec les champs suivants :

- Nom
- Email
- Mot de passe

Une fois le compte crÃ©Ã©, il est redirigÃ© vers la page de connexion.

### ğŸ¢ Connexion, sÃ©lection de la sociÃ©tÃ© et navigation

1ï¸âƒ£ Connexion initiale :

Lâ€™utilisateur sâ€™authentifie avec email + mot de passe.

    Backend gÃ©nÃ¨re un JWT simple de courte durÃ©e (5 min par exemple) :
    
    hasSociete = false
    
    Pas de compteId
    
    Ce token ne permet que dâ€™appeler /comptes/select.

AprÃ¨s connexion (via email + mot de passe), l'utilisateur accÃ¨de Ã  une nouvelle page listant ses sociÃ©tÃ©s (le cas
Ã©chÃ©ant).

Sâ€™il nâ€™en a aucune, un bouton **"CrÃ©er une sociÃ©tÃ©"** lui est proposÃ©.

Lors de la crÃ©ation dâ€™une sociÃ©tÃ©, les Ã©lÃ©ments suivants sont gÃ©nÃ©rÃ©s :

- Enregistrement de la sociÃ©tÃ© (`societes`)
- CrÃ©ation automatique du rÃ´le `PROPRIETAIRE`
- Affectation de lâ€™utilisateur courant Ã  cette sociÃ©tÃ© avec le rÃ´le `PROPRIETATIRE` (`comptes_societe`)

2ï¸âƒ£ SÃ©lection de sociÃ©tÃ© :

Lâ€™utilisateur choisit une sociÃ©tÃ© â†’ appel Ã  `/comptes/select` avec le 1er token.

    Backend vÃ©rifie :
    
    Que la sociÃ©tÃ© appartient Ã  lâ€™utilisateur.
    
    Que hasSociete est bien false.
    
    GÃ©nÃ¨re un nouveau JWT enrichi (plus longue durÃ©e, ex : 24h) :
    
    hasSociete = true
    
    Contient compteId.

3ï¸âƒ£ RequÃªtes mÃ©tier :

Un filtre Spring Security bloque toute requÃªte qui nâ€™a pas hasSociete = true.

Les endpoints sensibles nâ€™ont donc jamais accÃ¨s Ã  un token â€œincompletâ€.

L'utilisateur sÃ©lectionne une sociÃ©tÃ© pour dÃ©finir le contexte dâ€™exÃ©cution.

Une fois la sociÃ©tÃ© choisie, le menu principal est affichÃ©, donnant accÃ¨s aux diffÃ©rentes fonctionnalitÃ©s (gestion des
utilisateurs, rÃ´les, opÃ©rations, natures, etc.).

![CrÃ©ation de compte - Kobbo](CreationCompte.png)

### ğŸ” Authentification

Tous les endpoints (sauf [POST] /api/v1/kobbo/utilisateurs et [POST] /api/v1/kobbo/auth/login) nÃ©cessitent un JWT valide
dans lâ€™en-tÃªte Authorization.

    Authorization: Bearer <token>

### ğŸ†• Ajout de logique lors de la crÃ©ation de sociÃ©tÃ©

Quand un utilisateur authentifiÃ© appelle :

    POST /api/societes

Le backend effectue les actions suivantes (transaction atomique) :

1- CrÃ©e la sociÃ©tÃ©

2- CrÃ©e automatiquement un rÃ´le par dÃ©faut PROPRIETAIRE (si non existant)

3- CrÃ©e une entrÃ©e dans comptes_societe liant lâ€™utilisateur, la sociÃ©tÃ© et le rÃ´le PROPRIETAIRE

#### ğŸ“Œ Exemple JSON - CrÃ©ation sociÃ©tÃ©

RequÃªte :

    POST /api/societes
    Authorization: Bearer <jwt>

    {
        "nom": "Kobbo SARL",
        "description": "SociÃ©tÃ© de test"
    }

RÃ©ponse :

    {
        "id": "uuid-societe",
        "nom": "Kobbo SARL",
        "admin": {
            "idUtilisateur": "uuid-user",
            "role": "PROPRIETAIRE"
        }
    }

# ğŸ“‹ Endpoints REST - Kobbo API

| MÃ©thode | Endpoint                                   | Description                                  |
|---------|--------------------------------------------|----------------------------------------------|
| POST    | `/api/v1/kobbo/utilisateurs`               | CrÃ©er un compte utilisateur                  |
| POST    | `/api/v1/kobbo/auth/login`                 | Connexion utilisateur, renvoie un JWT        |
| GET     | `/api/v1/kobbo/societes`                   | Lister les sociÃ©tÃ©s dâ€™un utilisateur         |
| POST    | `/api/v1/kobbo/societes`                   | CrÃ©er une sociÃ©tÃ©                            |
| GET     | `/api/v1/kobbo/societes/{id}/utilisateurs` | Liste des utilisateurs dâ€™une sociÃ©tÃ©         |
| POST    | `/api/v1/kobbo/societes/{id}/utilisateurs` | Ajouter un utilisateur Ã  une sociÃ©tÃ©         |
| GET     | `/api/v1/kobbo/societes/{id}/roles`        | Lister les rÃ´les disponibles                 |
| POST    | `/api/v1/kobbo/societes/{id}/roles`        | Ajouter un rÃ´le Ã  la sociÃ©tÃ©                 |
| POST    | `/api/v1/kobbo/comptes`                    | CrÃ©er un compte utilisateur dans une sociÃ©tÃ© |

## ğŸš€ Installation

### ğŸ”§ PrÃ©requis

- Java 17+
- MySQL 8+
- Maven / Gradle
- (Optionnel) Docker & Docker Compose

### ğŸ“¥ Ã‰tapes

1. Clonez le projet :

```bash
git clone https://github.com/votre-utilisateur/kobbo.git
cd kobbo
```

### ğŸ¤ Contribution

Les contributions sont les bienvenues !

Forkez le projet

CrÃ©ez une branche (feature/ma-fonctionnalite)

Commitez vos modifications (git commit -am 'Ajout nouvelle fonctionnalitÃ©')

Pushez (git push origin feature/ma-fonctionnalite)

Ouvrez une Pull Request

### ğŸ‘¨â€ğŸ’» Auteur

DÃ©veloppÃ© avec â¤ï¸ par Corneille GBEAGA.
Contact : cgbeaga@gmail.com

---
